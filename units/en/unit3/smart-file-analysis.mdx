# Module 2: Smart File Analysis

## Introduction

In this module, you'll enhance your PR Agent with MCP Resources - a powerful way to provide Claude with project context. While Tools let Claude perform actions, Resources let Claude read and understand your project's specific requirements, standards, and patterns.

## What You Will Learn

- The difference between MCP Tools and Resources
- How to implement Resources with different URI patterns
- Providing project context to improve Claude's decision-making
- Best practices for Resource design and organization

## Overview

Resources are MCP's way of exposing data that Claude can read and use for context. In this module, you'll implement four types of resources:

1. **Template Resources** (`file://templates/{filename}`) - Individual PR template access
2. **Team Guidelines** (`file://team-guidelines/{filename}`) - Coding standards, PR guidelines
3. **Git History** (`git://recent-changes`) - Recent commit patterns
4. **Team Review Process** (`team://review-process`) - Review requirements and SLAs

## Getting Started

### Prerequisites

- Completed Module 1 or familiarity with MCP Tools
- Python 3.10 or higher
- A git repository with some commit history

### Starter Code

Navigate to the starter code directory:

```bash
cd projects/unit3/smart-file-analysis/starter
```

Install dependencies:

```bash
uv sync --all-extras
```

### Your Task

The starter code includes all Module 1 tools. Your task is to add Resources that provide contextual information:

1. **Implement `read_template` resource**
   - Allow Claude to read individual template files
   - Use the `TEMPLATES_DIR` path

2. **Implement `read_team_guidelines` resource**  
   - Read files from the `team-guidelines` directory
   - Handle missing files gracefully

3. **Implement `get_recent_changes` resource**
   - Use git commands to fetch recent commit history
   - Return structured JSON data

4. **Implement `get_team_review_process` resource**
   - Return team review processes and requirements
   - Can be hardcoded for this exercise

### Design Considerations

#### Resources vs Tools

- **Tools**: Perform actions, may have side effects (`analyze_file_changes`)
- **Resources**: Read-only data access, no side effects (`read_template`)

#### URI Patterns

Resources use URI-like patterns to organize data:
- `protocol://path` structure
- Can include dynamic segments: `{filename}`
- Should be intuitive and discoverable

#### Team Guidelines Directory

For this exercise, we hardcode the path to the shared team guidelines:
```python
TEAM_GUIDELINES_DIR = Path(__file__).parent.parent.parent / "team-guidelines"
```

This directory is shared across all modules (just like templates) and contains:
- `coding-standards.md` - Python coding conventions
- `pr-guidelines.md` - PR best practices

In production, this path would typically be configurable via:
- Environment variables
- Configuration files
- Command-line arguments
- Auto-detection from git root

## Testing Your Implementation

### 1. Verify Team Guidelines

The team guidelines are already provided in the shared directory:

```bash
ls projects/unit3/team-guidelines/
# Should show: coding-standards.md, pr-guidelines.md
```

### 2. Test with Claude Code

Configure your server in Claude Code:

```bash
# Add the MCP server
claude mcp add pr-agent -- uv --directory /absolute/path/to/smart-file-analysis/starter run server.py

# Verify it's configured
claude mcp list
```

Then ask Claude:
- "What are our team's coding standards?"
- "Show me recent commit patterns"
- "What's our PR review process?"

## Common Patterns

### Resource Implementation Pattern

```python
@mcp.resource("protocol://path/{parameter}")
async def resource_name(parameter: str) -> str:
    """Resource description for Claude.
    
    Args:
        parameter: Dynamic path parameter
    """
    # Read and return data
    return content
```

### Error Handling for Resources

```python
if not path.exists():
    return f"File {filename} not found"
```

## Troubleshooting

- **Resources not appearing**: Check your URI patterns match exactly
- **File not found**: Ensure team-guidelines directory exists and contains the files
- **Git errors**: Make sure you're in a git repository with history
- **Path issues**: Verify TEAM_GUIDELINES_DIR points to the correct location

## Next Steps

Once you've completed this module:
1. Review the solution in `/projects/unit3/smart-file-analysis/solution/`
2. Experiment with different resource types and URI patterns
3. Move on to Module 3 for GitHub Actions integration

## Additional Resources

- [MCP Resources Documentation](https://modelcontextprotocol.io/docs/concepts/resources)
- [URI Design Best Practices](https://modelcontextprotocol.io/docs/concepts/resources#uri-design)